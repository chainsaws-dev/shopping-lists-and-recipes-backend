"use strict";(self.webpackChunkshopping_lists_and_recipes=self.webpackChunkshopping_lists_and_recipes||[]).push([[621],{9621:(P,h,i)=>{i.r(h),i.d(h,{UserProfileModule:()=>A});var p=i(9808),u=i(2340),e=i(5e3),l=i(5909),f=i(3649),d=i(8986),s=i(2382),b=i(655),m=i(520),U=i(384);let T=(()=>{class n{constructor(t,o){this.http=t,this.auth=o}transform(t){return(0,b.mG)(this,void 0,void 0,function*(){const o=this.auth.GetUserToken(),r=new m.WM({Auth:o,ApiKey:u.N.ApiKey});try{const c=yield this.http.get(t,{headers:r,responseType:"blob"}).toPromise(),g=new FileReader;return new Promise((C,F)=>{g.onloadend=()=>C(g.result),g.readAsDataURL(c)})}catch(c){return"/favicon.ico"}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.eN,16),e.Y36(U.e,16))},n.\u0275pipe=e.Yjl({name:"secureImagePipe",type:n,pure:!0}),n})();function _(n,a){1&n&&(e.TgZ(0,"div",5)(1,"span",6),e._uU(2,"Loading..."),e.qZA()())}function v(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"ngb-alert",7),e.NdJ("close",function(){return e.CHM(t),e.oxw().ShowMessage=!1}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("type",t.MessageType),e.xp6(1),e.hij(" ",t.ResponseFromBackend.Error.Message,"")}}function x(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"form",8,9),e.NdJ("ngSubmit",function(){e.CHM(t);const r=e.MAs(1);return e.oxw().OnSaveClick(r)}),e.TgZ(2,"div",10)(3,"div",11)(4,"h2"),e._uU(5,"Profile"),e.qZA(),e.TgZ(6,"div",10)(7,"label",12),e._uU(8,"Name"),e.qZA(),e._UZ(9,"input",13),e.qZA(),e.TgZ(10,"div",10)(11,"label",14),e._uU(12,"Email"),e.qZA(),e._UZ(13,"input",15),e.qZA(),e.TgZ(14,"div",10)(15,"label",16),e._uU(16,"Phone"),e.qZA(),e._UZ(17,"input",17),e.qZA(),e.TgZ(18,"label",18),e._uU(19,"Password"),e.qZA(),e.TgZ(20,"div",19)(21,"div",20)(22,"input",21),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().changepassword=r}),e.qZA()(),e._UZ(23,"input",22),e.qZA(),e.TgZ(24,"button",23),e._uU(25,"Save"),e.qZA(),e.TgZ(26,"button",24),e._uU(27,"Cancel"),e.qZA()()()()}if(2&n){const t=e.MAs(1),o=e.oxw();e.xp6(9),e.Q6J("ngModel",o.UserToEdit.Name),e.xp6(4),e.Q6J("ngModel",o.UserToEdit.Email),e.xp6(4),e.Q6J("ngModel",o.UserToEdit.Phone),e.xp6(5),e.Q6J("ngModel",o.changepassword),e.xp6(1),e.Q6J("disabled",!o.changepassword),e.xp6(1),e.Q6J("disabled",t.invalid)}}function w(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"h2"),e._uU(2,"Second factor enabled"),e.qZA(),e.TgZ(3,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().OnUnlinkTwoFactor()}),e._uU(4,"Disable"),e.qZA()()}}function Z(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"form",8,26),e.NdJ("ngSubmit",function(){e.CHM(t);const r=e.MAs(1);return e.oxw().OnLinkTwoFactor(r)}),e.TgZ(2,"div",10)(3,"div",11)(4,"h2"),e._uU(5,"Set second factor"),e.qZA(),e.TgZ(6,"h4"),e._uU(7,"1. Scan with "),e.TgZ(8,"a",27),e._uU(9,"Authenticator"),e.qZA(),e._uU(10,": "),e.qZA(),e._UZ(11,"img",28),e.ALo(12,"async"),e.ALo(13,"secureImagePipe"),e.TgZ(14,"h4"),e._uU(15,"2. Enter the token:"),e.qZA(),e.TgZ(16,"label",18),e._uU(17,"Token"),e.qZA(),e.TgZ(18,"div",19)(19,"div",20)(20,"input",29),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().SetTwoFactor=r}),e.qZA()(),e._UZ(21,"input",30),e.qZA(),e.TgZ(22,"button",31),e._uU(23,"Save"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(8),e.Q6J("href",t.AuthUrl,e.LSH),e.xp6(3),e.Q6J("src",e.lcZ(12,4,e.lcZ(13,6,t.QrUrl)),e.LSH),e.xp6(9),e.Q6J("ngModel",t.SetTwoFactor),e.xp6(1),e.Q6J("disabled",!t.SetTwoFactor)}}const M=[{path:"",component:(()=>{class n{constructor(t,o,r){this.activatedroute=t,this.router=o,this.datastore=r}ngOnDestroy(){this.FetchUser.unsubscribe(),this.RecivedErrorSub.unsubscribe(),this.DataLoading.unsubscribe(),this.SaveUser.unsubscribe(),this.LinkUnlinkTFA.unsubscribe()}ngOnInit(){this.AuthUrl=u.N.GetAuthenticatorUrl,this.QrUrl=u.N.GetTOTPQRCodeUrl,this.LinkUnlinkTFA=this.datastore.TwoFactorSub.subscribe(t=>{this.SetUserAndTFA(t)}),this.SaveUser=this.datastore.UserUpdateInsert.subscribe(t=>{this.SetUserAndTFA(t)}),this.FetchUser=this.datastore.CurrentUserFetch.subscribe(t=>{this.SetUserAndTFA(t)}),this.RecivedErrorSub=this.datastore.RecivedError.subscribe(t=>{this.ShowMessage=!0,this.ResponseFromBackend=t,setTimeout(()=>this.ShowMessage=!1,5e3),t&&(this.MessageType=200===t.Error.Code?"success":"danger")}),this.DataLoading=this.datastore.LoadingData.subscribe(t=>{this.IsLoading=t}),this.datastore.FetchCurrentUser()}SetUserAndTFA(t){this.UserToEdit=t,this.UserToEdit&&(this.TwoFactorEnabled=this.UserToEdit.SecondFactor)}OnSaveClick(t){if(t.valid){if(t.value.changepassword&&0===t.value.newpassword.length)return;this.UserToEdit.Email=t.value.useremail,this.UserToEdit.Name=t.value.username,this.UserToEdit.Phone=t.value.userphone,this.datastore.SaveCurrentUser(this.UserToEdit,t.value.changepassword,t.value.newpassword)}}OnLinkTwoFactor(t){t.valid&&this.datastore.LinkTwoFactor(t.value.passkey,this.UserToEdit)}OnUnlinkTwoFactor(){this.UserToEdit.SecondFactor&&this.datastore.UnlinkTwoFactor(this.UserToEdit)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.gz),e.Y36(l.F0),e.Y36(f.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-user-profile"]],decls:6,vars:5,consts:[[1,"text-center"],["class","spinner-border","role","status",4,"ngIf"],[3,"type","close",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],["class","form-group",4,"ngIf"],["role","status",1,"spinner-border"],[1,"visually-hidden-focusable"],[3,"type","close"],[3,"ngSubmit"],["UserProfileForm","ngForm"],[1,"form-group"],[2,"margin","3px"],["for","name"],["type","text","id","name","placeholder","example","name","username","required","",1,"form-control","mb-1",3,"ngModel"],["for","email"],["type","email","id","email","placeholder","exampe@example.com","name","useremail","required","","email","",1,"form-control","mb-1",3,"ngModel"],["for","phone"],["type","tel","id","phone","placeholder","+7 (965) 777-77-77","name","userphone","pattern","^((8|\\+7)[\\- ]?)?(\\(?\\d{3,4}\\)?[\\- ]?)?[\\d\\- ]{5,10}$",1,"form-control","mb-1",3,"ngModel"],["for","newpassword"],[1,"input-group","mb-3"],[1,"input-group-text"],["type","checkbox","id","changepassword","name","changepassword",1,"form-check-input","mt-0",3,"ngModel","ngModelChange"],["type","password","id","newpassword","name","newpassword","placeholder","Enter new password","ngModel","",1,"form-control",3,"disabled"],["type","submit",1,"btn","btn-outline-primary",3,"disabled"],["type","button","routerLink","..",1,"btn","btn-outline-danger",2,"margin-left","3px"],["type","button",1,"btn","btn-outline-danger",3,"click"],["UserTwoFactorForm","ngForm"],[3,"href"],["alt","QR code",3,"src"],["type","checkbox","id","enabletwofactor","name","enabletwofactor","required","",3,"ngModel","ngModelChange"],["type","text","name","passkey","inputmode","numeric","pattern","[0-9]*","autocomplete","one-time-code","id","newpasskey","placeholder","Token from Authenticator","ngModel","","required","","minlength","6","ngbTooltip","Minimum 6 numbers",1,"form-control",3,"disabled"],["type","submit",1,"btn","btn-outline-primary"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,_,3,0,"div",1),e.qZA(),e.YNc(2,v,2,2,"ngb-alert",2),e.YNc(3,x,28,6,"form",3),e.YNc(4,w,5,0,"div",4),e.YNc(5,Z,24,8,"form",3)),2&t&&(e.xp6(1),e.Q6J("ngIf",o.IsLoading),e.xp6(1),e.Q6J("ngIf",o.ShowMessage),e.xp6(1),e.Q6J("ngIf",o.UserToEdit),e.xp6(1),e.Q6J("ngIf",o.UserToEdit&&o.TwoFactorEnabled),e.xp6(1),e.Q6J("ngIf",o.UserToEdit&&!o.TwoFactorEnabled))},directives:[p.O5,d.xm,s._Y,s.JL,s.F,s.Fj,s.Q7,s.JJ,s.On,s.on,s.c5,s.Wl,l.rH,s.Zs,s.wO,d._L],pipes:[p.Ov,T],styles:["input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#ff0a1d!important;box-shadow:none!important}input.ng-invalid.ng-touched[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #ff0a1d40!important}input.ng-valid.ng-touched[_ngcontent-%COMP%]{border-color:#67c07b!important;box-shadow:none!important}input.ng-valid.ng-touched[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #34b30d40!important}select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#ff0a1d!important;box-shadow:none!important}select.ng-invalid.ng-touched[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #ff0a1d40!important}select.ng-valid.ng-touched[_ngcontent-%COMP%]{border-color:#67c07b!important;box-shadow:none!important}select.ng-valid.ng-touched[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #34b30d40!important}.image-placeholder[_ngcontent-%COMP%]{background-color:#eee;display:flex;height:333px;margin:5px;border-radius:3px;max-width:592px}.image-placeholder[_ngcontent-%COMP%] > h4[_ngcontent-%COMP%]{align-self:center;text-align:center;width:100%}"]}),n})()}];let A=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[p.ez,s.u5,d._A,l.Bz.forChild(M),d.HK]]}),n})()}}]);